# === auth_service/app.py ===
from flask import Flask, request, jsonify
import mysql.connector

app = Flask(__name__)

DB_CONFIG = {
    'host': 'YOUR_WRITER_ENDPOINT',
    'user': 'Admin',
    'password': 'YOUR_PASSWORD',
    'database': 'realmadrid_db'
}

@app.route('/signup', methods=['POST'])
def signup():
    data = request.json
    conn = mysql.connector.connect(**DB_CONFIG)
    cursor = conn.cursor()
    cursor.execute("INSERT INTO users (username, password) VALUES (%s, %s)", (data['username'], data['password']))
    conn.commit()
    conn.close()
    return jsonify({'message': 'Signup successful'})

@app.route('/login', methods=['POST'])
def login():
    data = request.json
    conn = mysql.connector.connect(**DB_CONFIG)
    cursor = conn.cursor(dictionary=True)
    cursor.execute("SELECT * FROM users WHERE username=%s AND password=%s", (data['username'], data['password']))
    user = cursor.fetchone()
    conn.close()
    if user:
        return jsonify({'message': 'Login successful', 'username': data['username']})
    else:
        return jsonify({'message': 'Login failed'}), 401

if __name__ == '__main__':
    app.run(port=5001, host='0.0.0.0')


# === player_service/app.py ===
from flask import Flask, jsonify
import mysql.connector

app = Flask(__name__)

DB_CONFIG = {
    'host': 'YOUR_READER_ENDPOINT',
    'user': 'Admin',
    'password': 'YOUR_PASSWORD',
    'database': 'realmadrid_db'
}

CLOUDFRONT_URL = "https://YOUR_CLOUDFRONT_URL"

@app.route('/players', methods=['GET'])
def get_players():
    conn = mysql.connector.connect(**DB_CONFIG)
    cursor = conn.cursor(dictionary=True)
    cursor.execute("SELECT * FROM players")
    players = cursor.fetchall()
    for player in players:
        player['image_file'] = f"{CLOUDFRONT_URL}/{player['image_file']}"
    conn.close()
    return jsonify(players)

if __name__ == '__main__':
    app.run(port=5002, host='0.0.0.0')


# === frontend/app.py ===
from flask import Flask, render_template_string, request, redirect, session
import requests

app = Flask(__name__)
app.secret_key = 'super-secret-key'

AUTH_SERVICE_URL = "http://localhost:5001"
PLAYER_SERVICE_URL = "http://localhost:5002"

@app.route('/')
def home():
    return render_template_string('''
        <html>
        <head>
            <title>Welcome</title>
            <style>
                body { background-color: orange; text-align: center; }
                .form-box { background: white; color: black; padding: 20px; border-radius: 10px; margin: auto; width: 300px; }
            </style>
        </head>
        <body>
            <h1>Welcome to RealMadrid</h1>
            <div class="form-box">
                <h3>Signup</h3>
                <form method="POST" action="/signup">
                    Username: <input name="username" required><br><br>
                    Password: <input name="password" type="password" required><br><br>
                    <button type="submit">Signup</button>
                </form>
            </div>

            <div class="form-box">
                <h3>Login</h3>
                <form method="POST" action="/login">
                    Username: <input name="username" required><br><br>
                    Password: <input name="password" type="password" required><br><br>
                    <button type="submit">Login</button>
                </form>
            </div>
        </body>
        </html>
    ''')

@app.route('/signup', methods=['POST'])
def signup():
    username = request.form['username']
    password = request.form['password']
    res = requests.post(f"{AUTH_SERVICE_URL}/signup", json={'username': username, 'password': password})
    if res.status_code == 200:
        session['username'] = username
        return redirect('/dashboard')
    return "Signup failed"

@app.route('/login', methods=['POST'])
def login():
    username = request.form['username']
    password = request.form['password']
    res = requests.post(f"{AUTH_SERVICE_URL}/login", json={'username': username, 'password': password})
    if res.status_code == 200:
        session['username'] = username
        return redirect('/dashboard')
    return "Login failed"

@app.route('/dashboard')
def dashboard():
    if 'username' not in session:
        return redirect('/')
    res = requests.get(f"{PLAYER_SERVICE_URL}/players")
    players = res.json()
    return render_template_string('''
        <html>
        <head><title>Dashboard</title></head>
        <body>
            <h2>Welcome to RealMadrid Fan App!</h2>
            <h3>Player Gallery:</h3>
            {% for player in players %}
                <div>
                    <strong>{{ player.player_name }}</strong><br>
                    <img src="{{ player.image_file }}" width="200"><br><br>
                </div>
            {% endfor %}
        </body>
        </html>
    ''', players=players)

if __name__ == '__main__':
    app.run(port=5000, host='0.0.0.0')
