import json
import boto3
import pymysql
import os

# Database configuration
db_config = {
    "host": "your-db-cluster-endpoint",
    "user": "Admin",
    "password": "your-password",
    "database": "realmadrid_db"
}

def lambda_handler(event, context):
    try:
        for record in event['Records']:
            bucket = record['s3']['bucket']['name']
            s3_key = record['s3']['object']['key']  # e.g., Players/Benzema.jpg

            # Extract just the file name (remove any folder prefix like "Players/")
            image_file = os.path.basename(s3_key)  # e.g., Benzema.jpg

            # Remove extension and format player name
            player_name = os.path.splitext(image_file)[0].replace('-', ' ').title()  # e.g., "Toni Kroos"

            # Insert into DB
            connection = pymysql.connect(**db_config)
            with connection.cursor() as cursor:
                sql = "INSERT INTO players (player_name, image_file) VALUES (%s, %s)"
                cursor.execute(sql, (player_name, image_file))
                connection.commit()
                print(f"Inserted {player_name} â†’ {image_file}")

            connection.close()

        return {
            'statusCode': 200,
            'body': json.dumps('Success')
        }

    except Exception as e:
        print("Error:", str(e))
        return {
            'statusCode': 500,
            'body': json.dumps('Failed')
        }


{
  "Records": [
    {
      "s3": {
        "bucket": {
          "name": "your-s3-bucket-name"
        },
        "object": {
          "key": "cristiano.jpg"
        }
      }
    }
  ]
}
