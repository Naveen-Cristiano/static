Perfect! Since you already have:

CodeDeploy agent installed on all TG-1 instances (A and B),

GitHub repo and branch experiment-1 with app code ready,


Let’s proceed step-by-step to create the CodePipeline that connects GitHub → CodeDeploy → EC2 (TG-1):


---

Step-by-Step: Create CodePipeline for TG-1

Step 1: Prepare an S3 bucket for artifacts

This bucket will store CodePipeline artifacts temporarily.

Go to S3 → Create bucket → Name it (e.g., pipeline-artifacts-tg1)

Block all public access → Enable versioning → Create



---

Step 2: Create CodeDeploy Application

1. Go to CodeDeploy → Applications → Create application


2. Name: MyApp-TG1


3. Compute Platform: EC2/On-Premises


4. Create




---

Step 3: Create CodeDeploy Deployment Group

1. Open MyApp-TG1 → Click “Create deployment group”


2. Name: MyDG-TG1


3. Service Role: Select or create IAM role with AWSCodeDeployRole


4. Deployment Type: In-place


5. Environment Configuration:

Choose Amazon EC2 Instances

Use EC2 Tags or choose instances via Auto Scaling Group (optional)

Or attach the Target Group TG-1 directly



6. Load Balancer: Choose Application Load Balancer and select TG-1


7. Deployment Settings:

Choose CodeDeployDefault.AllAtOnce for now



8. Create




---

Step 4: Ensure appspec.yml is present in your GitHub repo

Your GitHub repo (branch experiment-1) should have an appspec.yml like:

version: 0.0
os: linux
files:
  - source: /
    destination: /var/www/html
hooks:
  AfterInstall:
    - location: scripts/start_server.sh
      timeout: 300
      runas: ec2-user

And a folder called scripts/ with start_server.sh that starts your app or server.


---

Step 5: Create CodePipeline

1. Go to CodePipeline → Create pipeline


2. Pipeline Name: MyPipeline-TG1


3. Service Role: Let it create a new one


4. Artifact Store: Choose the S3 bucket pipeline-artifacts-tg1




---

Step 6: Add Source Stage

1. Source Provider: GitHub (v2)


2. Connect your GitHub


3. Choose repo: your-repo-name


4. Branch: experiment-1


5. Change detection: GitHub webhooks




---

Step 7: Skip Build Stage for now

You can skip the build stage (select “No build stage”) if no build actions needed.


---

Step 8: Add Deploy Stage

1. Deploy provider: AWS CodeDeploy


2. Application Name: MyApp-TG1


3. Deployment Group: MyDG-TG1




---

Step 9: Review & Create

Click Create Pipeline.

Once created, it will:

Pull your code from GitHub branch experiment-1

Use appspec.yml to install files in /var/www/html

Use scripts/start_server.sh if defined



---

Let me know once your pipeline is created and if appspec.yml and scripts are ready. We’ll then test the full flow!



version: 0.0
os: linux
files:
  - source: /
    destination: /var/www/html

hooks:
  BeforeInstall:
    - location: scripts/stop.sh
      timeout: 60
      runas: root

  AfterInstall:
    - location: scripts/start.sh
      timeout: 60
      runas: root


#!/bin/bash
echo "Starting httpd server..."
sudo systemctl start httpd

#!/bin/bash
echo "Stopping httpd server..."
sudo systemctl stop httpd

experiment-1/
├── index.html (and any other site files)
├── appspec.yml
└── scripts/
    ├── start.sh
    └── stop.sh
